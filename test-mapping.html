<!DOCTYPE html>
<html>
<head>
    <title>Data Mapping Test</title>
    <style>
        table { border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Data Mapping Diagnostic</h1>
    <div id="results"></div>
    
    <script>
        // Simple version of the mapping function
        function getValueFromRow(row, headerText) {
            const normalizedHeader = headerText.toLowerCase().trim();
            
            const directMapping = {
                'conference': row.conference,
                'teams': row.teams,
                'avg rating': row.avgRating,
                'top team': row.topTeam,
                'win %': row.winPct
            };
            
            if (directMapping[normalizedHeader] !== undefined) {
                return directMapping[normalizedHeader];
            }
            
            // Fallback: try camelCase conversion
            const camelCaseHeader = toCamelCase(normalizedHeader);
            if (row[camelCaseHeader] !== undefined) {
                return row[camelCaseHeader];
            }
            
            return `MISSING: ${normalizedHeader}`;
        }
        
        function toCamelCase(str) {
            return str.replace(/(?:^\w|[A-Z]|\b\w)/g, (word, index) => {
                return index === 0 ? word.toLowerCase() : word.toUpperCase();
            }).replace(/\s+/g, '').replace(/[^a-zA-Z0-9]/g, '');
        }
        
        async function testMapping() {
            const results = document.getElementById('results');
            
            try {
                // Test conferences data
                const response = await fetch('data/conferences.json');
                const conferences = await response.json();
                const sampleConf = conferences[0];
                
                results.innerHTML += '<h2>Sample Conference Data:</h2>';
                results.innerHTML += `<pre>${JSON.stringify(sampleConf, null, 2)}</pre>`;
                
                results.innerHTML += '<h2>Header Mapping Test:</h2>';
                results.innerHTML += '<table>';
                results.innerHTML += '<tr><th>Header</th><th>Expected Property</th><th>Mapped Value</th><th>Status</th></tr>';
                
                const headers = ["Conference", "Teams", "Avg Rating", "Top Team", "Win %"];
                
                headers.forEach(header => {
                    const value = getValueFromRow(sampleConf, header);
                    const status = value.toString().startsWith('MISSING:') ? 
                        '<span class="error">❌ FAILED</span>' : 
                        '<span class="success">✅ SUCCESS</span>';
                    
                    results.innerHTML += `<tr>
                        <td>${header}</td>
                        <td>${toCamelCase(header.toLowerCase())}</td>
                        <td>${value}</td>
                        <td>${status}</td>
                    </tr>`;
                });
                
                results.innerHTML += '</table>';
                
            } catch (error) {
                results.innerHTML += `<p class="error">Error: ${error.message}</p>`;
            }
        }
        
        testMapping();
    </script>
</body>
</html>